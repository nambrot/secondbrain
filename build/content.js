// Generated by CoffeeScript 1.7.1
(function() {
  $(function() {
    return chrome.storage.sync.get({
      "domains": []
    }, function(data) {
      var clone;
      if (!document.location.protocol.match(/http[^s]/)) {
        return;
      }
      if (data.domains.some(function(domain) {
        return document.location.host.match(domain);
      })) {
        return;
      }
      clone = $('body').clone();
      clone.find('script').remove();
      clone.find('style').remove();
      return chrome.storage.sync.get({
        token: null,
        email: null,
        baseUrl: "http://memex2.herokuapp.com/"
      }, function(data) {
        if (data.token) {
          $.post(data.baseUrl + "/api/log", {
            url: document.location.href,
            html: clone.text().replace(/\s+/g, " "),
            user_token: data.token,
            user_email: data.email
          }, function(evt) {});
          return console.log("Memex Logged to " + data.baseUrl);
        }
      });
    });
  });

}).call(this);
